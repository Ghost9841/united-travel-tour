Next.js with cPanel

**Next.js doesn't work with cPanel** out of the box because cPanel is primarily designed for PHP and static websites, not for running Node.js applications that require a server process. However, it **is possible to deploy Next.js on cPanel** with the right setup.

### Key Requirements and Solutions

- **Use `next export` for Static Sites**: If your app is **static (no server-side rendering or API routes)**, use `next export` to generate static HTML, CSS, and JS files. Upload the `out` folder to cPanel’s `public_html` directory. This approach avoids the need for a Node.js server.

- **Use a Custom Server for SSR/SSG**: For apps with server-side rendering (SSR), dynamic routes, or API routes, you need a **custom server**. Create a `server.js` file in your project root with the following code:
  ```js
  const { createServer } = require('http');
  const { parse } = require('url');
  const next = require('next');

  const app = next({ dev: false });
  const handle = app.getRequestHandler();

  app.prepare().then(() => {
    createServer((req, res) => {
      const parsedUrl = parse(req.url, true);
      const { pathname } = parsedUrl;
      handle(req, res, parsedUrl);
    }).listen(3000, (err) => {
      if (err) throw err;
      console.log('> Ready on http://localhost:3000');
    });
  });
  ```

- **Configure `package.json`**:
  ```json
  "scripts": {
    "build": "next build",
    "start": "NODE_ENV=production node server.js"
  }
  ```

- **Deploy via cPanel Node.js Selector**:
  1. In cPanel, go to **Node.js Selector**.
  2. Create a new app, pointing the **Application Startup File** to `server.js`.
  3. Upload your project files (including `.next`, `public`, `server.js`, `package.json`) via FTP or File Manager.
  4. **Do not run `npm run build` on the server**—build locally and upload the `.next` folder.

- **Fix Common Issues**:
  - **Blank Pages on Refresh**: Use a `.htaccess` file to route all requests to `index.html`:
    ```apache
    <IfModule mod_rewrite.c>
      RewriteEngine On
      RewriteCond %{REQUEST_FILENAME} !-f
      RewriteCond %{REQUEST_FILENAME} !-d
      RewriteRule ^(.*)$ /index.html [L]
    </IfModule>
    ```
  - **Image Optimization Errors**: If using `sharp`, ensure it's installed and set `NEXT_SHARP_PATH` in environment variables.
  - **Memory Limits**: Avoid building on the server; build locally and upload the `.next` folder.

- **Recommended Alternative**: Use **Vercel** or **Netlify** for a simpler, free, and optimized deployment. They natively support Next.js and handle server-side rendering, static exports, and CI/CD.

> **Bottom Line**: Next.js *can* work on cPanel, but it requires a custom server, careful file setup, and avoiding server-side build processes. For most users, **Vercel is the best choice**.